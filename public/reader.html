<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Comic Reader</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Inter',sans-serif}

:root{
  --bg:#0b0b12;
  --text:#ffffff;
  --card:#141421;
}

body{
  background:var(--bg);
  color:var(--text);
  padding-bottom:90px;
  overflow-x:hidden;
}

/* ===== HEADER ===== */
.reader-header{
  position:fixed;
  top:0;
  width:100%;
  height:56px;
  background:rgba(15,15,25,.9);
  backdrop-filter:blur(10px);
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 14px;
  z-index:10;
  transition:.25s;
}
.reader-header.hidden{transform:translateY(-100%)}

.reader-header button{
  background:none;
  border:none;
  color:#fff;
  font-size:22px;
}
.reader-header select{
  background:#161625;
  color:#fff;
  border:none;
  padding:6px 8px;
  border-radius:8px;
}

/* ===== CONTENT ===== */
.reader-content{
  padding:70px 0 90px;
}

/* ===== TOP CARD ===== */
.top-card{
  display:flex;
  gap:14px;
  background:var(--card);
  margin:0 14px 20px;
  padding:14px;
  border-radius:14px;
}
.top-cover{
  width:110px;
  height:160px;
  border-radius:12px;
  overflow:hidden;
  flex-shrink:0;
}
.top-cover img{
  width:100%;
  height:100%;
  object-fit:cover;
}
.top-info{
  flex:1;
  font-size:14px;
  line-height:1.5;
  opacity:.9;
  display:-webkit-box;
  -webkit-line-clamp:6;
  -webkit-box-orient:vertical;
  overflow:hidden;
}

/* ===== ZOOM ===== */
#zoomLayer{
  transform-origin:center top;
  transition:transform .2s ease;
}

/* ===== PAGES ===== */
.page{margin-bottom:10px}
.page img{width:100%;display:block}

/* ===== FLOAT ===== */
.float-btn{
  position:fixed;
  right:14px;
  bottom:100px;
  display:flex;
  flex-direction:column;
  gap:10px;
  transition:.25s;
}
.float-btn.hidden{opacity:0;pointer-events:none}
.float-btn button{
  width:44px;
  height:44px;
  border-radius:50%;
  background:rgba(31,31,54,.55);
  backdrop-filter:blur(8px);
  border:none;
  color:#fff;
  font-size:20px;
}

/* ===== FOOTER ===== */
.reader-footer{
  position:fixed;
  bottom:0;
  width:100%;
  height:72px;
  background:rgba(15,15,25,.9);
  backdrop-filter:blur(10px);
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:0 20px;
  transition:.25s;
}
.reader-footer.hidden{transform:translateY(100%)}
.reader-footer button{
  background:none;
  border:none;
  color:#fff;
  font-size:22px;
}
.reader-footer span{
  font-size:13px;
  opacity:.7;
}
</style>
</head>

<body>

<!-- HEADER -->
<div class="reader-header" id="header">
  <button onclick="history.back()"><i class="ri-arrow-left-line"></i></button>
  <select id="chapterSelect"></select>
  <button onclick="toggleMode()"><i class="ri-contrast-line"></i></button>
</div>

<!-- CONTENT -->
<div class="reader-content">

  <div class="top-card">
    <div class="top-cover"><img id="coverImg"></div>
    <div class="top-info" id="synopsis"></div>
  </div>

  <div id="zoomLayer">
    <div id="pages"></div>
  </div>

</div>

<!-- FLOAT -->
<div class="float-btn" id="floatBtn">
  <button onclick="scrollTopPage()"><i class="ri-arrow-up-line"></i></button>
  <button onclick="scrollBottomPage()"><i class="ri-arrow-down-line"></i></button>
</div>

<!-- FOOTER -->
<div class="reader-footer" id="footer">
  <button onclick="prevChapter()"><i class="ri-arrow-left-s-line"></i></button>
  <span id="chapterInfo"></span>
  <button onclick="nextChapter()"><i class="ri-arrow-right-s-line"></i></button>
</div>

<script>
/* ===== PARAM ===== */
const parts = location.pathname.split("/");

// /comic/sensei/1
const comicId = parts[2];
let chapter = parts[3] || "1";
const SAVE_KEY = `last_read_${comicId}`;

/* ===== LOAD JSON ===== */
fetch("/data/data.json")
.then(r=>r.json())
.then(data=>{
  const comic = data[comicId];
  if(!comic) return alert("Comic tidak ditemukan");

  if(!comic.chapters[chapter]){
    alert("Chapter tidak tersedia");
    return;
  }

  coverImg.src = comic.cover;
  synopsis.textContent = comic.synopsis;
  chapterInfo.textContent = `Chapter ${chapter}`;

  const chapters = Object.keys(comic.chapters).map(Number).sort((a,b)=>a-b);

  chapterSelect.innerHTML = chapters.map(c=>
    `<option value="${c}" ${c==chapter?'selected':''}>Chapter ${c}</option>`
  ).join("");

  chapterSelect.onchange = () => {
  location.href = `/comic/${comicId}/${chapterSelect.value}`;
};

  pages.innerHTML = comic.chapters[chapter].images.map(img=>
    `<div class="page"><img src="${img}" loading="lazy"></div>`
  ).join("");

  restoreScroll();
});

/* ===== SAVE SCROLL ===== */
window.addEventListener("scroll",()=>{
  localStorage.setItem(SAVE_KEY,JSON.stringify({
    chapter,
    scroll:window.scrollY
  }));
});

function restoreScroll(){
  const saved = JSON.parse(localStorage.getItem(SAVE_KEY));
  if(saved && saved.chapter==chapter){
    setTimeout(()=>window.scrollTo(0,saved.scroll),300);
  }
}

/* ===== NAV ===== */
function prevChapter(){
  const p = Number(chapter)-1;
  if(p>=1) location.href = `/comic/${comicId}/${p}`;
}
function nextChapter(){
  location.href = `/comic/${comicId}/${Number(chapter) + 1}`;
}

/* ===== MODE ===== */
let dark=true;
function toggleMode(){
  dark=!dark;
  document.documentElement.style.setProperty("--bg",dark?"#0b0b12":"#f2f2f2");
  document.documentElement.style.setProperty("--text",dark?"#fff":"#000");
  document.documentElement.style.setProperty("--card",dark?"#141421":"#fff");
}

/* ===== SCROLL ===== */
function scrollTopPage(){window.scrollTo({top:0,behavior:"smooth"})}
function scrollBottomPage(){window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})}

/* ===== TAP HIDE UI ===== */
let ui=true;
document.addEventListener("click",e=>{
  if(e.target.closest("button")||e.target.tagName==="SELECT")return;
  ui=!ui;
  header.classList.toggle("hidden",!ui);
  footer.classList.toggle("hidden",!ui);
  floatBtn.classList.toggle("hidden",!ui);
});

/* ===== ZOOM ===== */
let scale=1,lastTap=0;
document.addEventListener("pointerdown",()=>{
  const now=Date.now();
  if(now-lastTap<300){
    scale = scale===1?2:1;
    zoomLayer.style.transform=`scale(${scale})`;
  }
  lastTap=now;
});

/* ===== PINCH ===== */
let startDist=0;
zoomLayer.addEventListener("touchstart",e=>{
  if(e.touches.length===2){
    startDist = Math.hypot(
      e.touches[0].clientX-e.touches[1].clientX,
      e.touches[0].clientY-e.touches[1].clientY
    );
  }
});
zoomLayer.addEventListener("touchmove",e=>{
  if(e.touches.length===2){
    e.preventDefault();
    const d = Math.hypot(
      e.touches[0].clientX-e.touches[1].clientX,
      e.touches[0].clientY-e.touches[1].clientY
    );
    scale = Math.min(2,Math.max(1,scale*(d/startDist)));
    startDist=d;
    zoomLayer.style.transform=`scale(${scale})`;
  }
},{passive:false});
</script>

</body>
</html>